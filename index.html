<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Retirement Benefits Calculator</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background-color: #f4f7fa;
      margin: 0;
      padding: 20px;
      color: #333;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      background: #fff;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
    h2 {
      color: #2c3e50;
      text-align: center;
      margin-bottom: 20px;
    }
    p.intro {
      text-align: center;
      color: #7f8c8d;
      margin-bottom: 30px;
    }
    form {
      display: grid;
      gap: 15px;
    }
    label {
      font-weight: bold;
      color: #34495e;
    }
    input, select {
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      width: 100%;
      max-width: 300px;
    }
    button {
      background-color: #3498db;
      color: #fff;
      padding: 10px 20px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      transition: background-color 0.3s;
    }
    button:hover {
      background-color: #2980b9;
    }
    #results {
      margin-top: 30px;
    }
    .result-card {
      background: #ecf0f1;
      padding: 20px;
      border-radius: 6px;
      margin-bottom: 20px;
      border-left: 4px solid #3498db;
    }
    .result-card h4 {
      margin-top: 0;
      color: #2c3e50;
    }
    .result-card p {
      margin: 5px 0;
      line-height: 1.5;
    }
    .result-card strong {
      color: #34495e;
    }
    .summary-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 30px;
    }
    .summary-table th, .summary-table td {
      border: 1px solid #ddd;
      padding: 10px;
      text-align: right;
    }
    .summary-table th {
      background-color: #2c3e50;
      color: #fff;
    }
    .summary-table tr:nth-child(even) {
      background-color: #f9f9f9;
    }
    .summary-table tr:hover {
      background-color: #f1f1f1;
    }
    .summary-table td:first-child {
      text-align: left;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Retirement Benefits Calculator</h2>
    <p class="intro">Enter your details below to estimate your retirement benefits for up to four dates.</p>
    <form id="retirementForm">
      <label for="tier">Select Tier:</label>
      <select id="tier" name="tier">
        <option value="1">Tier 1 (Enrolled before July 1, 2007)</option>
        <option value="2">Tier 2 (Enrolled on/after July 1, 2007)</option>
      </select>

      <label for="workStartDate">Work Start Date:</label>
      <input type="date" id="workStartDate" name="workStartDate" required>

      <label for="birthDate">Your Birthdate:</label>
      <input type="date" id="birthDate" name="birthDate" required>

      <label for="spouseBirthDate">Spouse's Birthdate (optional):</label>
      <input type="date" id="spouseBirthDate" name="spouseBirthDate">

      <label for="retirementDate1">Retirement Date 1 (must be first of the month):</label>
      <input type="date" id="retirementDate1" name="retirementDate1" required>
      <label for="averageSalary1">Average Salary for Date 1:</label>
      <input type="number" id="averageSalary1" name="averageSalary1" step="0.01" min="0" required>

      <label for="retirementDate2">Retirement Date 2 (must be first of the month):</label>
      <input type="date" id="retirementDate2" name="retirementDate2" required>
      <label for="averageSalary2">Average Salary for Date 2:</label>
      <input type="number" id="averageSalary2" name="averageSalary2" step="0.01" min="0" required>

      <label for="retirementDate3">Retirement Date 3 (must be first of the month):</label>
      <input type="date" id="retirementDate3" name="retirementDate3" required>
      <label for="averageSalary3">Average Salary for Date 3:</label>
      <input type="number" id="averageSalary3" name="averageSalary3" step="0.01" min="0" required>

      <label for="retirementDate4">Retirement Date 4 (must be first of the month):</label>
      <input type="date" id="retirementDate4" name="retirementDate4" required>
      <label for="averageSalary4">Average Salary for Date 4:</label>
      <input type="number" id="averageSalary4" name="averageSalary4" step="0.01" min="0" required>

      <button type="button" onclick="calculateRetirement()">Calculate Benefits</button>
    </form>

    <div id="results"></div>
  </div>

  <script>
    function calculateRetirement() {
      const tier = document.getElementById('tier').value;
      const workStartDate = new Date(document.getElementById('workStartDate').value);
      const birthDate = new Date(document.getElementById('birthDate').value);
      const spouseBirthDate = document.getElementById('spouseBirthDate').value ? new Date(document.getElementById('spouseBirthDate').value) : null;

      const retirementDates = [
        { date: new Date(document.getElementById('retirementDate1').value), salary: parseFloat(document.getElementById('averageSalary1').value) },
        { date: new Date(document.getElementById('retirementDate2').value), salary: parseFloat(document.getElementById('averageSalary2').value) },
        { date: new Date(document.getElementById('retirementDate3').value), salary: parseFloat(document.getElementById('averageSalary3').value) },
        { date: new Date(document.getElementById('retirementDate4').value), salary: parseFloat(document.getElementById('averageSalary4').value) }
      ];

      let detailedResults = '';
      let summaryData = [];

      retirementDates.forEach((ret, index) => {
        const retirementDate = ret.date;
        const averageSalary = ret.salary;

        const terminationDate = new Date(retirementDate);
        terminationDate.setDate(terminationDate.getDate() - 1);

        const serviceCredit = (terminationDate - workStartDate) / (1000 * 60 * 60 * 24 * 365.25);
        const ageAtRetirement = calculateAge(birthDate, retirementDate);

        let retirementType = 'Early';
        let thresholdAge = tier === '1' ? 60 : 62;
        if (tier === '1' && ageAtRetirement >= 60) {
          retirementType = 'Service';
        } else if (tier === '2' && ageAtRetirement >= 62) {
          retirementType = 'Service';
        }
        let maxOption;
        let maxOptionCalc;
        if (retirementType === 'Service') {
          maxOption = (serviceCredit / 55) * averageSalary;
          maxOptionCalc = `(${serviceCredit.toFixed(2)} years / 55) * ${averageSalary.toLocaleString('en-US', { style: 'currency', currency: 'USD' })}`;
        } else {
          const reductionFactor = Math.max(1 - (thresholdAge - ageAtRetirement) * 0.01, 0.5);
          maxOption = (serviceCredit / 55) * averageSalary * reductionFactor;
          maxOptionCalc = `(${serviceCredit.toFixed(2)} years / 55) * ${averageSalary.toLocaleString('en-US', { style: 'currency', currency: 'USD' })} * ${reductionFactor.toFixed(2)} (reduction factor)`;
        }

        let optionA, optionB, optionC, optionD;
        let optionACalc, optionBCalc, optionCCalc, optionDCalc;
        if (spouseBirthDate) {
          const spouseAge = calculateAge(spouseBirthDate, retirementDate);
          const factors = getFactors(Math.floor(ageAtRetirement), Math.floor(spouseAge));
          optionA = maxOption * factors.A;
          optionB = maxOption * factors.B;
          optionC = maxOption * factors.C;
          optionD = maxOption * factors.D;
          optionACalc = `${maxOption.toLocaleString('en-US', { style: 'currency', currency: 'USD' })} * ${factors.A.toFixed(4)}`;
          optionBCalc = `${maxOption.toLocaleString('en-US', { style: 'currency', currency: 'USD' })} * ${factors.B.toFixed(4)}`;
          optionCCalc = `${maxOption.toLocaleString('en-US', { style: 'currency', currency: 'USD' })} * ${factors.C.toFixed(4)}`;
          optionDCalc = `${maxOption.toLocaleString('en-US', { style: 'currency', currency: 'USD' })} * ${factors.D.toFixed(4)}`;
        } else {
          optionA = optionB = optionC = optionD = 'N/A (No spouse)';
          optionACalc = optionBCalc = optionCCalc = optionDCalc = 'N/A';
        }

        detailedResults += `
          <div class="result-card">
            <h4>Retirement Date ${index + 1}: ${retirementDate.toLocaleDateString()}</h4>
            <p><strong>Service Credit:</strong> ${serviceCredit.toFixed(2)} years (from ${workStartDate.toLocaleDateString()} to ${terminationDate.toLocaleDateString()})</p>
            <p><strong>Age at Retirement:</strong> ${ageAtRetirement} years</p>
            <p><strong>Retirement Type:</strong> ${retirementType}</p>
            <p><strong>Maximum Option:</strong> ${maxOption.toLocaleString('en-US', { style: 'currency', currency: 'USD' })}<br>Calculation: ${maxOptionCalc}</p>
            <p><strong>Option A (100% to survivor):</strong> ${typeof optionA === 'number' ? optionA.toLocaleString('en-US', { style: 'currency', currency: 'USD' }) : optionA}<br>Calculation: ${optionACalc}</p>
            <p><strong>Option B (75% to survivor):</strong> ${typeof optionB === 'number' ? optionB.toLocaleString('en-US', { style: 'currency', currency: 'USD' }) : optionB}<br>Calculation: ${optionBCalc}</p>
            <p><strong>Option C (50% to survivor):</strong> ${typeof optionC === 'number' ? optionC.toLocaleString('en-US', { style: 'currency', currency: 'USD' }) : optionC}<br>Calculation: ${optionCCalc}</p>
            <p><strong>Option D (25% to survivor):</strong> ${typeof optionD === 'number' ? optionD.toLocaleString('en-US', { style: 'currency', currency: 'USD' }) : optionD}<br>Calculation: ${optionDCalc}</p>
          </div>
        `;

        summaryData.push({
          date: retirementDate.toLocaleDateString(),
          maxOption: maxOption.toLocaleString('en-US', { style: 'currency', currency: 'USD' }),
          optionA: typeof optionA === 'number' ? optionA.toLocaleString('en-US', { style: 'currency', currency: 'USD' }) : optionA,
          optionB: typeof optionB === 'number' ? optionB.toLocaleString('en-US', { style: 'currency', currency: 'USD' }) : optionB,
          optionC: typeof optionC === 'number' ? optionC.toLocaleString('en-US', { style: 'currency', currency: 'USD' }) : optionC,
          optionD: typeof optionD === 'number' ? optionD.toLocaleString('en-US', { style: 'currency', currency: 'USD' }) : optionD
        });
      });

      // Build summary table
      let summaryTable = `
        <h3>Summary of Retirement Options</h3>
        <table class="summary-table">
          <tr>
            <th>Retirement Date</th>
            <th>Maximum Option</th>
            <th>Option A (100%)</th>
            <th>Option B (75%)</th>
            <th>Option C (50%)</th>
            <th>Option D (25%)</th>
          </tr>
      `;
      summaryData.forEach(row => {
        summaryTable += `
          <tr>
            <td>${row.date}</td>
            <td>${row.maxOption}</td>
            <td>${row.optionA}</td>
            <td>${row.optionB}</td>
            <td>${row.optionC}</td>
            <td>${row.optionD}</td>
          </tr>
        `;
      });
      summaryTable += '</table>';

      document.getElementById('results').innerHTML = detailedResults + summaryTable;
    }

    function calculateAge(birthDate, targetDate) {
      let age = targetDate.getFullYear() - birthDate.getFullYear();
      const m = targetDate.getMonth() - birthDate.getMonth();
      if (m < 0 || (m === 0 && targetDate.getDate() < birthDate.getDate())) {
        age--;
      }
      return age;
    }

    function getFactors(memberAge, spouseAge) {
      const tables = {
        A: {
          55: { 55: 0.8206, 56: 0.8265, 57: 0.8324, 58: 0.8383, 59: 0.8442, 60: 0.8565, 61: 0.8624, 62: 0.8683, 63: 0.8742, 64: 0.8801, 65: 0.8898, 66: 0.8957, 67: 0.9016, 68: 0.9075, 69: 0.9134, 70: 0.9202 },
          56: { 55: 0.8147, 56: 0.8206, 57: 0.8265, 58: 0.8324, 59: 0.8383, 60: 0.8505, 61: 0.8565, 62: 0.8624, 63: 0.8683, 64: 0.8742, 65: 0.8839, 66: 0.8898, 67: 0.8957, 68: 0.9016, 69: 0.9075, 70: 0.9143 },
          57: { 55: 0.8088, 56: 0.8147, 57: 0.8206, 58: 0.8265, 59: 0.8324, 60: 0.8446, 61: 0.8505, 62: 0.8565, 63: 0.8624, 64: 0.8683, 65: 0.8780, 66: 0.8839, 67: 0.8898, 68: 0.8957, 69: 0.9016, 70: 0.9084 },
          58: { 55: 0.8029, 56: 0.8088, 57: 0.8147, 58: 0.8206, 59: 0.8265, 60: 0.8387, 61: 0.8446, 62: 0.8505, 63: 0.8565, 64: 0.8624, 65: 0.8721, 66: 0.8780, 67: 0.8839, 68: 0.8898, 69: 0.8957, 70: 0.9025 },
          59: { 55: 0.7970, 56: 0.8029, 57: 0.8088, 58: 0.8147, 59: 0.8206, 60: 0.8327, 61: 0.8387, 62: 0.8446, 63: 0.8505, 64: 0.8565, 65: 0.8662, 66: 0.8721, 67: 0.8780, 68: 0.8839, 69: 0.8898, 70: 0.8966 },
          60: { 55: 0.7950, 56: 0.8009, 57: 0.8068, 58: 0.8127, 59: 0.8186, 60: 0.8438, 61: 0.8497, 62: 0.8556, 63: 0.8615, 64: 0.8674, 65: 0.8858, 66: 0.8917, 67: 0.8976, 68: 0.9035, 69: 0.9094, 70: 0.9228 },
          61: { 55: 0.7891, 56: 0.7950, 57: 0.8009, 58: 0.8068, 59: 0.8127, 60: 0.8378, 61: 0.8438, 62: 0.8497, 63: 0.8556, 64: 0.8615, 65: 0.8799, 66: 0.8858, 67: 0.8917, 68: 0.8976, 69: 0.9035, 70: 0.9169 },
          62: { 55: 0.7832, 56: 0.7891, 57: 0.7950, 58: 0.8009, 59: 0.8068, 60: 0.8319, 61: 0.8378, 62: 0.8438, 63: 0.8497, 64: 0.8556, 65: 0.8740, 66: 0.8799, 67: 0.8858, 68: 0.8917, 69: 0.8976, 70: 0.9110 },
          63: { 55: 0.7773, 56: 0.7832, 57: 0.7891, 58: 0.7950, 59: 0.8009, 60: 0.8260, 61: 0.8319, 62: 0.8378, 63: 0.8438, 64: 0.8497, 65: 0.8681, 66: 0.8740, 67: 0.8799, 68: 0.8858, 69: 0.8917, 70: 0.9051 },
          64: { 55: 0.7714, 56: 0.7773, 57: 0.7832, 58: 0.7891, 59: 0.7950, 60: 0.8201, 61: 0.8260, 62: 0.8319, 63: 0.8378, 64: 0.8438, 65: 0.8622, 66: 0.8681, 67: 0.8740, 68: 0.8799, 69: 0.8858, 70: 0.8992 },
          65: { 55: 0.7626, 56: 0.7685, 57: 0.7744, 58: 0.7803, 59: 0.7862, 60: 0.8206, 61: 0.8265, 62: 0.8324, 63: 0.8383, 64: 0.8442, 65: 0.8728, 66: 0.8787, 67: 0.8846, 68: 0.8905, 69: 0.8964, 70: 0.9178 },
          66: { 55: 0.7567, 56: 0.7626, 57: 0.7685, 58: 0.7744, 59: 0.7803, 60: 0.8147, 61: 0.8206, 62: 0.8265, 63: 0.8324, 64: 0.8383, 65: 0.8669, 66: 0.8728, 67: 0.8787, 68: 0.8846, 69: 0.8905, 70: 0.9119 },
          67: { 55: 0.7508, 56: 0.7567, 57: 0.7626, 58: 0.7685, 59: 0.7744, 60: 0.8088, 61: 0.8147, 62: 0.8206, 63: 0.8265, 64: 0.8324, 65: 0.8610, 66: 0.8669, 67: 0.8728, 68: 0.8787, 69: 0.8846, 70: 0.9060 },
          68: { 55: 0.7449, 56: 0.7508, 57: 0.7567, 58: 0.7626, 59: 0.7685, 60: 0.8029, 61: 0.8088, 62: 0.8147, 63: 0.8206, 64: 0.8265, 65: 0.8551, 66: 0.8610, 67: 0.8669, 68: 0.8728, 69: 0.8787, 70: 0.9001 },
          69: { 55: 0.7390, 56: 0.7449, 57: 0.7508, 58: 0.7567, 59: 0.7626, 60: 0.7970, 61: 0.8029, 62: 0.8088, 63: 0.8147, 64: 0.8206, 65: 0.8492, 66: 0.8551, 67: 0.8610, 68: 0.8669, 69: 0.8728, 70: 0.8942 },
          70: { 55: 0.7237, 56: 0.7296, 57: 0.7355, 58: 0.7414, 59: 0.7473, 60: 0.7890, 61: 0.7950, 62: 0.8009, 63: 0.8068, 64: 0.8127, 65: 0.8508, 66: 0.8567, 67: 0.8626, 68: 0.8685, 69: 0.8744, 70: 0.9067 }
        },
        B: {
          55: { 55: 0.8565, 56: 0.8615, 57: 0.8665, 58: 0.8715, 59: 0.8765, 60: 0.8858, 61: 0.8908, 62: 0.8958, 63: 0.9008, 64: 0.9058, 65: 0.9131, 66: 0.9181, 67: 0.9231, 68: 0.9281, 69: 0.9331, 70: 0.9375 },
          56: { 55: 0.8515, 56: 0.8565, 57: 0.8615, 58: 0.8665, 59: 0.8715, 60: 0.8808, 61: 0.8858, 62: 0.8908, 63: 0.8958, 64: 0.9008, 65: 0.9081, 66: 0.9131, 67: 0.9181, 68: 0.9231, 69: 0.9281, 70: 0.9325 },
          57: { 55: 0.8465, 56: 0.8515, 57: 0.8565, 58: 0.8615, 59: 0.8665, 60: 0.8758, 61: 0.8808, 62: 0.8858, 63: 0.8908, 64: 0.8958, 65: 0.9031, 66: 0.9081, 67: 0.9131, 68: 0.9181, 69: 0.9231, 70: 0.9275 }
        }
      };

      const mAge = Math.max(55, Math.min(70, memberAge));
      const sAge = Math.max(55, Math.min(70, spouseAge));

      return {
        A: tables.A[mAge][sAge],
        B: tables.B[mAge][sAge],
        C: tables.C[mAge][sAge] || 0, // Default to 0 if not defined
        D: tables.D[mAge][sAge] || 0  // Default to 0 if not defined
      };
    }
  </script>
</body>
</html>
